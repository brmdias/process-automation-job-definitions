- defaultTab: nodes
  description: Checks for any global/widespread issues specifically related to Microsoft.
  executionEnabled: true
  group: Use Cases/Outages
  id: 747298c3-2ed5-487d-833f-54403ed628f5
  loglevel: INFO
  name: Check for GCP Outages (scheduled)
  nodeFilterEditable: false
  plugins:
    ExecutionLifecycle: {}
  scheduleEnabled: true
  schedules: []
  sequence:
    commands:
    - description: Check GCP Status
      fileExtension: .py
      interpreterArgsQuoted: false
      plugins:
        LogFilter: []
      script: |-
        import sys
        import urllib.request
        import json

        def check_gcp_status():
            gcp_status_url = 'https://status.cloud.google.com/incidents.json'
            try:
                response = urllib.request.urlopen(gcp_status_url)
                content = response.read()
                data = json.loads(content)
            except urllib.error.URLError as e:
                print(f"Error fetching the GCP status: {e}")
                sys.exit(1)
            except json.JSONDecodeError as e:
                print(f"Error parsing the GCP status: {e}")
                sys.exit(1)

            issues = []
            for incident in data:
                # Check for the presence of expected keys
                status = incident.get('status', 'unknown')
                service_name = incident.get('service_name', 'Unknown Service')
                description = incident.get('external_desc', 'No description available')
                begin_date = incident.get('begin', 'No date available')

                # Adjust the condition based on the actual data structure
                if status != 'resolved':
                    issues.append({
                        'title': service_name,
                        'description': description,
                        'date': begin_date
                    })

            if issues:
                print("GCP Status Issues Detected:")
                for issue in issues:
                    print(f"Service: {issue['title']}")
                    print(f"Description: {issue['description']}")
                    print(f"Date: {issue['date']}")
                    print("-----")
                sys.exit(1)
            else:
                print("No issues found in the GCP status feed.")
                sys.exit(0)

        if __name__ == "__main__":
            check_gcp_status()
      scriptInterpreter: python
    - exec: echo Hello World
    keepgoing: false
    strategy: node-first
  uuid: 747298c3-2ed5-487d-833f-54403ed628f5

