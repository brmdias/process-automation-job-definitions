- defaultTab: nodes
  description: TBD
  executionEnabled: true
  group: Tests/Job Queue
  id: 13cae146-b0da-4e38-9fa4-eefda2a30654
  loglevel: INFO
  name: Automated Test Job Queue
  nodeFilterEditable: false
  nodefilters:
    dispatch:
      excludePrecedence: true
      keepgoing: false
      rankOrder: ascending
      successOnEmptyNodeFilter: false
      threadcount: '1'
    filter: 'name: pdt-bdias-rundeckers-runner '
  nodesSelectedByDefault: true
  options:
  - label: Job UUID
    name: job-uuid
    value: 20725236-f0d6-4a4a-8462-05718acd94e7
  plugins:
    ExecutionLifecycle: {}
  runnerSelector:
    runnerFilterMode: LOCAL
    runnerFilterType: LOCAL_RUNNER
  scheduleEnabled: true
  schedules: []
  sequence:
    commands:
    - autoSecureInput: 'false'
      description: Trigger multiple job runs
      fileExtension: .py
      interpreterArgsQuoted: false
      passSecureInput: 'false'
      plugins:
        LogFilter: []
      script: "#!/usr/bin/env python3\n\"\"\"\nScript to trigger multiple Rundeck\
        \ job executions via API.\nTriggers 10 executions for a specified job UUID.\n\
        \"\"\"\n\nimport requests\nimport time\nimport json\nfrom typing import List,\
        \ Dict\n\n# Configuration\nRUNDECK_URL = \"https://bdias.myrundeck.com\" \
        \ # Update with your Rundeck URL\nAPI_TOKEN = \"1HUm3R7as2hfeNNfdx1DvtjlfYi8YjDG\"\
        \  # Update with your API token\nJOB_UUID = \"@option.job-uuid@\"  # Update\
        \ with your job UUID\nNUM_EXECUTIONS = 10\n\n# API endpoints\nAPI_VERSION\
        \ = \"45\"  # Rundeck API version\nHEADERS = {\n    \"X-Rundeck-Auth-Token\"\
        : API_TOKEN,\n    \"Content-Type\": \"application/json\",\n    \"Accept\"\
        : \"application/json\"\n}\n\n\ndef trigger_job_execution(job_uuid: str, options:\
        \ Dict = None) -> Dict:\n    \"\"\"\n    Trigger a single job execution.\n\
        \    \n    Args:\n        job_uuid: The UUID of the job to execute\n     \
        \   options: Optional dictionary of job options\n        \n    Returns:\n\
        \        Response data from the API\n    \"\"\"\n    url = f\"{RUNDECK_URL}/api/{API_VERSION}/job/{job_uuid}/run\"\
        \n    \n    payload = {}\n    if options:\n        payload[\"options\"] =\
        \ options\n    \n    try:\n        response = requests.post(url, headers=HEADERS,\
        \ json=payload)\n        response.raise_for_status()\n        return response.json()\n\
        \    except requests.exceptions.RequestException as e:\n        print(f\"\
        Error triggering execution: {e}\")\n        if hasattr(e.response, 'text'):\n\
        \            print(f\"Response: {e.response.text}\")\n        return None\n\
        \n\ndef get_execution_status(execution_id: str) -> Dict:\n    \"\"\"\n   \
        \ Get the status of a job execution.\n    \n    Args:\n        execution_id:\
        \ The execution ID\n        \n    Returns:\n        Execution status data\n\
        \    \"\"\"\n    url = f\"{RUNDECK_URL}/api/{API_VERSION}/execution/{execution_id}\"\
        \n    \n    try:\n        response = requests.get(url, headers=HEADERS)\n\
        \        response.raise_for_status()\n        return response.json()\n   \
        \ except requests.exceptions.RequestException as e:\n        print(f\"Error\
        \ getting execution status: {e}\")\n        return None\n\n\ndef main():\n\
        \    \"\"\"Main execution function.\"\"\"\n    print(f\"Starting {NUM_EXECUTIONS}\
        \ executions for job UUID: {JOB_UUID}\")\n    print(f\"Rundeck URL: {RUNDECK_URL}\"\
        )\n    print(\"-\" * 60)\n    \n    execution_ids: List[str] = []\n    \n\
        \    # Trigger executions\n    for i in range(1, NUM_EXECUTIONS + 1):\n  \
        \      print(f\"\\nTriggering execution {i}/{NUM_EXECUTIONS}...\")\n     \
        \   \n        # Optional: Add job options here if needed\n        # options\
        \ = {\"option_name\": \"option_value\"}\n        options = None\n        \n\
        \        result = trigger_job_execution(JOB_UUID, options)\n        \n   \
        \     if result and 'id' in result:\n            execution_id = str(result['id'])\n\
        \            execution_ids.append(execution_id)\n            print(f\"  ✓\
        \ Execution triggered successfully\")\n            print(f\"    Execution\
        \ ID: {execution_id}\")\n            print(f\"    Permalink: {result.get('permalink',\
        \ 'N/A')}\")\n        else:\n            print(f\"  ✗ Failed to trigger execution\
        \ {i}\")\n        \n        # Small delay between requests to avoid overwhelming\
        \ the API\n        if i < NUM_EXECUTIONS:\n            time.sleep(0.5)\n \
        \   \n    print(\"\\n\" + \"=\" * 60)\n    print(f\"Summary: Triggered {len(execution_ids)}\
        \ out of {NUM_EXECUTIONS} executions\")\n    print(\"=\" * 60)\n    \n   \
        \ if execution_ids:\n        print(\"\\nExecution IDs:\")\n        for exec_id\
        \ in execution_ids:\n            print(f\"  - {exec_id}\")\n        \n   \
        \     # Optional: Check status of all executions\n        print(\"\\nChecking\
        \ execution statuses...\")\n        for exec_id in execution_ids:\n      \
        \      status_data = get_execution_status(exec_id)\n            if status_data:\n\
        \                status = status_data.get('status', 'unknown')\n         \
        \       print(f\"  Execution {exec_id}: {status}\")\n\n\nif __name__ == \"\
        __main__\":\n    main()\n"
      scriptInterpreter: python
    keepgoing: false
    strategy: node-first
  user: admin
  uuid: 13cae146-b0da-4e38-9fa4-eefda2a30654

